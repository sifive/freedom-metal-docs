
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>CPU &#8212; Freedom Metal v20.05.RC.03 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GPIO" href="gpio.html" />
    <link rel="prev" title="Clocks" href="clock.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="cpu">
<h1>CPU<a class="headerlink" href="#cpu" title="Permalink to this headline">¶</a></h1>
<p>API for accessing CPU capabilities. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Typedefs</p>
<dl class="cpp type">
<dt id="_CPPv425metal_exception_handler_t">
<span id="_CPPv325metal_exception_handler_t"></span><span id="_CPPv225metal_exception_handler_t"></span><span id="metal_exception_handler_t"></span><span class="target" id="cpu_8h_1ab3b821a3347e5837b93dd66bc4241c04"></span><em class="property">typedef </em>void (*<code class="sig-name descname">metal_exception_handler_t</code>)<span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *cpu, int ecode<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv425metal_exception_handler_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Function signature for exception handlers. </p>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Functions</p>
<dl class="cpp function">
<dt id="_CPPv413metal_cpu_getj">
<span id="_CPPv313metal_cpu_getj"></span><span id="_CPPv213metal_cpu_getj"></span><span id="metal_cpu_get__unsigned-i"></span><span class="target" id="cpu_8h_1a94de247e1c4cc930d28367dd3dc30706"></span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<code class="sig-name descname">metal_cpu_get</code><span class="sig-paren">(</span>unsigned int <em>hartid</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv413metal_cpu_getj" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get a reference to a CPU hart. </p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>A pointer to the CPU device handle </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hartid</span></code>: The ID of the desired CPU hart </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv428metal_cpu_get_current_hartidv">
<span id="_CPPv328metal_cpu_get_current_hartidv"></span><span id="_CPPv228metal_cpu_get_current_hartidv"></span><span id="metal_cpu_get_current_hartid__void"></span><span class="target" id="cpu_8h_1a267bbd9b9639aa33998789a9165e2d17"></span>int <code class="sig-name descname">metal_cpu_get_current_hartid</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv428metal_cpu_get_current_hartidv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the hartid of the CPU hart executing this function. </p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The hartid of the current CPU hart </p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv423metal_cpu_get_num_hartsv">
<span id="_CPPv323metal_cpu_get_num_hartsv"></span><span id="_CPPv223metal_cpu_get_num_hartsv"></span><span id="metal_cpu_get_num_harts__void"></span><span class="target" id="cpu_8h_1a8298338d21fbbc7229030bfdeac8dc04"></span>int <code class="sig-name descname">metal_cpu_get_num_harts</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv423metal_cpu_get_num_hartsv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the number of CPU harts. </p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The number of CPU harts </p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv419metal_cpu_get_timerP9metal_cpu">
<span id="_CPPv319metal_cpu_get_timerP9metal_cpu"></span><span id="_CPPv219metal_cpu_get_timerP9metal_cpu"></span><span id="metal_cpu_get_timer__metal_cpuP"></span><span class="target" id="cpu_8h_1a4e05fab40109301de46126c3414449d6"></span>__inline__ unsigned long long <code class="sig-name descname">metal_cpu_get_timer</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv419metal_cpu_get_timerP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the CPU cycle count timer value. </p>
<p>Get the value of the cycle count timer for a given CPU</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The value of the CPU cycle count timer </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv422metal_cpu_get_timebaseP9metal_cpu">
<span id="_CPPv322metal_cpu_get_timebaseP9metal_cpu"></span><span id="_CPPv222metal_cpu_get_timebaseP9metal_cpu"></span><span id="metal_cpu_get_timebase__metal_cpuP"></span><span class="target" id="cpu_8h_1ad914718b69cedeafba4fc7a3ee00a781"></span>__inline__ unsigned long long <code class="sig-name descname">metal_cpu_get_timebase</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv422metal_cpu_get_timebaseP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the timebase of the CPU. </p>
<p>Get the value of the timebase of the cycle count timer</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The value of the cycle count timer timebase </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv419metal_cpu_get_mtimeP9metal_cpu">
<span id="_CPPv319metal_cpu_get_mtimeP9metal_cpu"></span><span id="_CPPv219metal_cpu_get_mtimeP9metal_cpu"></span><span id="metal_cpu_get_mtime__metal_cpuP"></span><span class="target" id="cpu_8h_1a3653b40dd2a24483d2724ea3dca59b94"></span>__inline__ unsigned long long <code class="sig-name descname">metal_cpu_get_mtime</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv419metal_cpu_get_mtimeP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the value of the mtime RTC. </p>
<p>Get the value of the mtime real-time clock. The CPU interrupt controller must be initialized before this function is called or the return value will be 0.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The value of mtime, or 0 if failure </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv422metal_cpu_set_mtimecmpP9metal_cpuy">
<span id="_CPPv322metal_cpu_set_mtimecmpP9metal_cpuy"></span><span id="_CPPv222metal_cpu_set_mtimecmpP9metal_cpuy"></span><span id="metal_cpu_set_mtimecmp__metal_cpuP.unsigned-l-l"></span><span class="target" id="cpu_8h_1a446da24bbae739dea56e40821dd13b44"></span>__inline__ int <code class="sig-name descname">metal_cpu_set_mtimecmp</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em>, unsigned long long <em>time</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv422metal_cpu_set_mtimecmpP9metal_cpuy" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set the value of the RTC mtimecmp RTC. </p>
<p>Set the value of the mtime real-time clock compare register. The CPU interrupt controller must be initialized before this function is called or the return value will be -1;</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The value of mtimecmp or -1 if error </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code>: The value to set the compare register to </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv436metal_cpu_timer_interrupt_controllerP9metal_cpu">
<span id="_CPPv336metal_cpu_timer_interrupt_controllerP9metal_cpu"></span><span id="_CPPv236metal_cpu_timer_interrupt_controllerP9metal_cpu"></span><span id="metal_cpu_timer_interrupt_controller__metal_cpuP"></span><span class="target" id="cpu_8h_1a2515c875c94ae826715afad6c92e58e0"></span>__inline__ <em class="property">struct</em> <a class="reference internal" href="interrupt.html#_CPPv415metal_interrupt" title="metal_interrupt">metal_interrupt</a> *<code class="sig-name descname">metal_cpu_timer_interrupt_controller</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv436metal_cpu_timer_interrupt_controllerP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get a reference to RTC timer interrupt controller. </p>
<p>Get a reference to the interrupt controller for the real-time clock interrupt. The controller returned by this function must be initialized before any interrupts are registered or enabled with it.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>A pointer to the timer interrupt handle </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv432metal_cpu_timer_get_interrupt_idP9metal_cpu">
<span id="_CPPv332metal_cpu_timer_get_interrupt_idP9metal_cpu"></span><span id="_CPPv232metal_cpu_timer_get_interrupt_idP9metal_cpu"></span><span id="metal_cpu_timer_get_interrupt_id__metal_cpuP"></span><span class="target" id="cpu_8h_1a250f6a8d546c55c13711cdea07278f4e"></span>__inline__ int <code class="sig-name descname">metal_cpu_timer_get_interrupt_id</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv432metal_cpu_timer_get_interrupt_idP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the RTC timer interrupt id. </p>
<p>Get the interrupt ID of the real-time clock interrupt</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The timer interrupt ID </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv439metal_cpu_software_interrupt_controllerP9metal_cpu">
<span id="_CPPv339metal_cpu_software_interrupt_controllerP9metal_cpu"></span><span id="_CPPv239metal_cpu_software_interrupt_controllerP9metal_cpu"></span><span id="metal_cpu_software_interrupt_controller__metal_cpuP"></span><span class="target" id="cpu_8h_1ad73cf61f19815f75e594398ace83b4b4"></span>__inline__ <em class="property">struct</em> <a class="reference internal" href="interrupt.html#_CPPv415metal_interrupt" title="metal_interrupt">metal_interrupt</a> *<code class="sig-name descname">metal_cpu_software_interrupt_controller</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv439metal_cpu_software_interrupt_controllerP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get a reference to the software interrupt controller. </p>
<p>Get a reference to the interrupt controller for the software/inter-process interrupt. The controller returned by this function must be initialized before any interrupts are registered or enabled with it.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>A pointer to the software interrupt handle </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv435metal_cpu_software_get_interrupt_idP9metal_cpu">
<span id="_CPPv335metal_cpu_software_get_interrupt_idP9metal_cpu"></span><span id="_CPPv235metal_cpu_software_get_interrupt_idP9metal_cpu"></span><span id="metal_cpu_software_get_interrupt_id__metal_cpuP"></span><span class="target" id="cpu_8h_1acd25de1cfdd0c621560fc519fe157cea"></span>__inline__ int <code class="sig-name descname">metal_cpu_software_get_interrupt_id</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv435metal_cpu_software_get_interrupt_idP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the software interrupt id. </p>
<p>Get the interrupt ID for the software/inter-process interrupt</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>the software interrupt ID </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv426metal_cpu_software_set_ipiP9metal_cpui">
<span id="_CPPv326metal_cpu_software_set_ipiP9metal_cpui"></span><span id="_CPPv226metal_cpu_software_set_ipiP9metal_cpui"></span><span id="metal_cpu_software_set_ipi__metal_cpuP.i"></span><span class="target" id="cpu_8h_1a0e495c2095e82cd3826404e7360153c4"></span>__inline__ int <code class="sig-name descname">metal_cpu_software_set_ipi</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em>, int <em>hartid</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv426metal_cpu_software_set_ipiP9metal_cpui" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set the inter-process interrupt for a hart. </p>
<p>Trigger a software/inter-process interrupt for a hart. The CPU interrupt controller for the CPU handle passed to this function must be initialized before this function is called.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>0 upon success </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hartid</span></code>: The CPU hart ID to be interrupted </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv428metal_cpu_software_clear_ipiP9metal_cpui">
<span id="_CPPv328metal_cpu_software_clear_ipiP9metal_cpui"></span><span id="_CPPv228metal_cpu_software_clear_ipiP9metal_cpui"></span><span id="metal_cpu_software_clear_ipi__metal_cpuP.i"></span><span class="target" id="cpu_8h_1a98d0db5a2a787c593dbb5cfd76e07223"></span>__inline__ int <code class="sig-name descname">metal_cpu_software_clear_ipi</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em>, int <em>hartid</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv428metal_cpu_software_clear_ipiP9metal_cpui" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Clear the inter-process interrupt for a hart. </p>
<p>Clear the software/inter-process interrupt for a hart. The CPU interrupt controller for the CPU handle passed to this function must be initialized before this function is called.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>0 upon success </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hartid</span></code>: The CPU hart ID to clear </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv418metal_cpu_get_msipP9metal_cpui">
<span id="_CPPv318metal_cpu_get_msipP9metal_cpui"></span><span id="_CPPv218metal_cpu_get_msipP9metal_cpui"></span><span id="metal_cpu_get_msip__metal_cpuP.i"></span><span class="target" id="cpu_8h_1a18e97744ad3258cd27bc73fd5cc15218"></span>__inline__ int <code class="sig-name descname">metal_cpu_get_msip</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em>, int <em>hartid</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv418metal_cpu_get_msipP9metal_cpui" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the value of MSIP for the given hart. </p>
<p>Get the value of the machine software interrupt pending bit for the given hart. The CPU interrupt controller for the CPU handle passed as argument to this function must be initialized before this function is called.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>0 upon success </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: the CPU device handle </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hartid</span></code>: The CPU hart to read </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv430metal_cpu_interrupt_controllerP9metal_cpu">
<span id="_CPPv330metal_cpu_interrupt_controllerP9metal_cpu"></span><span id="_CPPv230metal_cpu_interrupt_controllerP9metal_cpu"></span><span id="metal_cpu_interrupt_controller__metal_cpuP"></span><span class="target" id="cpu_8h_1a860873285621329043b4eee925b784f9"></span>__inline__ <em class="property">struct</em> <a class="reference internal" href="interrupt.html#_CPPv415metal_interrupt" title="metal_interrupt">metal_interrupt</a> *<code class="sig-name descname">metal_cpu_interrupt_controller</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv430metal_cpu_interrupt_controllerP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the interrupt controller for the CPU. </p>
<p>Get the CPU interrupt controller. The controller returned by this function must be initialized before any interrupts are registered or enabled and before any exception handlers are registered with this CPU.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The handle for the CPU interrupt controller </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv428metal_cpu_exception_registerP9metal_cpui25metal_exception_handler_t">
<span id="_CPPv328metal_cpu_exception_registerP9metal_cpui25metal_exception_handler_t"></span><span id="_CPPv228metal_cpu_exception_registerP9metal_cpui25metal_exception_handler_t"></span><span id="metal_cpu_exception_register__metal_cpuP.i.metal_exception_handler_t"></span><span class="target" id="cpu_8h_1a7a3dc60d2adb664108e5d980c67847c8"></span>__inline__ int <code class="sig-name descname">metal_cpu_exception_register</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em>, int <em>ecode</em>, <a class="reference internal" href="#_CPPv425metal_exception_handler_t" title="metal_exception_handler_t">metal_exception_handler_t</a> <em>handler</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv428metal_cpu_exception_registerP9metal_cpui25metal_exception_handler_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Register an exception handler. </p>
<p>Register an exception handler for the CPU. The CPU interrupt controller must be initialized before this function is called.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>0 upon success </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ecode</span></code>: The exception code to register a handler for </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">handler</span></code>: Callback function for the exception handler </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv432metal_cpu_get_instruction_lengthP9metal_cpu9uintptr_t">
<span id="_CPPv332metal_cpu_get_instruction_lengthP9metal_cpu9uintptr_t"></span><span id="_CPPv232metal_cpu_get_instruction_lengthP9metal_cpu9uintptr_t"></span><span id="metal_cpu_get_instruction_length__metal_cpuP.uintptr_t"></span><span class="target" id="cpu_8h_1a00bad4168251e2764164a48e980f8e5f"></span>__inline__ int <code class="sig-name descname">metal_cpu_get_instruction_length</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em>, uintptr_t <em>epc</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv432metal_cpu_get_instruction_lengthP9metal_cpu9uintptr_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the length of an instruction in bytes. </p>
<p>Get the length of an instruction in bytes.</p>
<p>On RISC-V platforms, this is useful for detecting whether an instruction is compressed (2 bytes long) or uncompressed (4 bytes long).</p>
<p>This function is useful in conjuction with <code class="docutils literal notranslate"><a class="reference internal" href="#cpu_8h_1a902e7961d3992ecf6b8a4305c91abcbe"><span class="std std-ref"><span class="pre">metal_cpu_get_exception_pc()</span></span></a></code> and <code class="docutils literal notranslate"><a class="reference internal" href="#cpu_8h_1ac86b441ba0b1390e1f0fd9391fb9e36e"><span class="std std-ref"><span class="pre">metal_cpu_set_exception_pc()</span></span></a></code> in order to cause the exception handler to return execution after the faulting instruction.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>the length of the instruction in bytes </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epc</span></code>: The address of the instruction to measure </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv426metal_cpu_get_exception_pcP9metal_cpu">
<span id="_CPPv326metal_cpu_get_exception_pcP9metal_cpu"></span><span id="_CPPv226metal_cpu_get_exception_pcP9metal_cpu"></span><span id="metal_cpu_get_exception_pc__metal_cpuP"></span><span class="target" id="cpu_8h_1a902e7961d3992ecf6b8a4305c91abcbe"></span>__inline__ uintptr_t <code class="sig-name descname">metal_cpu_get_exception_pc</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv426metal_cpu_get_exception_pcP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the program counter of the current exception. </p>
<p>This function must be called within an exception handler. The behavior is undefined outside of an exception handler.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>The value of the program counter at the time of the exception </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv426metal_cpu_set_exception_pcP9metal_cpu9uintptr_t">
<span id="_CPPv326metal_cpu_set_exception_pcP9metal_cpu9uintptr_t"></span><span id="_CPPv226metal_cpu_set_exception_pcP9metal_cpu9uintptr_t"></span><span id="metal_cpu_set_exception_pc__metal_cpuP.uintptr_t"></span><span class="target" id="cpu_8h_1ac86b441ba0b1390e1f0fd9391fb9e36e"></span>__inline__ int <code class="sig-name descname">metal_cpu_set_exception_pc</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em>, uintptr_t <em>epc</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv426metal_cpu_set_exception_pcP9metal_cpu9uintptr_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set the exception program counter. </p>
<p>This function must be called within an exception handler. The behavior is undefined outside of an exception handler.</p>
<p>This function can be used to cause an exception handler to return execution to an address other than the one that caused the exception.</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>0 upon success </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: the CPU device handle </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epc</span></code>: The address to set the exception program counter to </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv422metal_cpu_get_buserrorP9metal_cpu">
<span id="_CPPv322metal_cpu_get_buserrorP9metal_cpu"></span><span id="_CPPv222metal_cpu_get_buserrorP9metal_cpu"></span><span id="metal_cpu_get_buserror__metal_cpuP"></span><span class="target" id="cpu_8h_1a8de0bf5a353e0087e7a5414710508bb4"></span>__inline__ <em class="property">struct</em> metal_buserror *<code class="sig-name descname">metal_cpu_get_buserror</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="#_CPPv49metal_cpu" title="metal_cpu">metal_cpu</a> *<em>cpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv422metal_cpu_get_buserrorP9metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the handle for the hart’s bus error unit. </p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>A pointer to the bus error unit handle </p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpu</span></code>: The CPU device handle </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
<dl class="cpp struct">
<dt id="_CPPv49metal_cpu">
<span id="_CPPv39metal_cpu"></span><span id="_CPPv29metal_cpu"></span><span id="metal_cpu"></span><span class="target" id="structmetal__cpu"></span><em class="property">struct </em><code class="sig-name descname">metal_cpu</code><a class="headerlink" href="#_CPPv49metal_cpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><em>#include &lt;cpu.h&gt;</em><p>A device handle for a CPU hart. </p>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Freedom Metal</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to Freedom Metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devguide.html">Developer Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="button.html">Buttons</a></li>
<li class="toctree-l2"><a class="reference internal" href="cache.html">Caches</a></li>
<li class="toctree-l2"><a class="reference internal" href="clock.html">Clocks</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">CPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio.html">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="init.html">Constructors and Destructors</a></li>
<li class="toctree-l2"><a class="reference internal" href="interrupt.html">Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="itim.html">ITIM</a></li>
<li class="toctree-l2"><a class="reference internal" href="led.html">LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="lock.html">Locks</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html">Memory Enumeration</a></li>
<li class="toctree-l2"><a class="reference internal" href="pmp.html">PMPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="rtc.html">Real-Time Clock</a></li>
<li class="toctree-l2"><a class="reference internal" href="shutdown.html">Shutdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="spi.html">SPIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="switch.html">Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="time.html">Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="timer.html">Timer API</a></li>
<li class="toctree-l2"><a class="reference internal" href="tty.html">TTY</a></li>
<li class="toctree-l2"><a class="reference internal" href="uart.html">UARTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="watchdog.html">Watchdog</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../api.html">API Reference</a><ul>
      <li>Previous: <a href="clock.html" title="previous chapter">Clocks</a></li>
      <li>Next: <a href="gpio.html" title="next chapter">GPIO</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SiFive Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/apiref/cpu.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>